<!doctype html>
<html lang="zh-CN" xmlns="http://www.w3.org/1999/html">
<head>
    <!-- 必须的 meta 标签 -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>work</title>
    <!-- CSS 文件 -->
    <link rel="stylesheet" href="./css/bootstrap.css">
    <link rel="stylesheet" href="./css/index.css">

    <!-- 引入js文件 -->
    <script src="./js/jquery-3.7.1.js"></script>
    <script src="./js/bootstrap.bundle.js"></script>
    <script src="./js/index.js"></script>
    <script src="./js/http_cdn.jsdelivr.net_npm_echarts@5.4.3_dist_echarts.js"></script>
    <script src="./js/http_unpkg.com_vue@3_dist_vue.global.js"></script>

    <style>
        /* 用于底下3个弹出层 */
        .zjh-canvas-border {
            padding-top: 2rem;
        }

        .myCanvas {
            height: 50%;
            border-radius: 20px 20px 0 0;
            --bs-offcanvas-height: initial;
            background-color: #38486CFF;
            /*background-image: linear-gradient(45deg, #D8DCF2, #F2E0DF, #D8E6F2, #F2F2F2);*/
        }

        .myLineMode {
            width: 100%;
            height: 40px;
            border-radius: 24px 24px 25px 25px;
        }

        .myBottom {
            background-color: black;
            color: white;
            padding: 0;
        }

        @keyframes bounceIn {
            0% {
                transform: translateY(100vw);
            }
            70% {
                transform: translateY(-1rem);
            }
            100% {
                transform: translateY(0);
            }
        }

        @keyframes bounceIn2 {
            0% {
                transform: translateY(0);
            }
            70% {
                transform: translateY(-3rem);
            }
            100% {
                transform: translateY(-3rem);
            }
        }

    </style>
</head>
<body>
<div id="app">
    <!-- <div style="position: fixed; display: flex; z-index: 1;"> -->
    <!--     <img src="img/logo.png" height="91" width="277" alt="logo"/> -->
    <!-- </div> -->
    <div style="width: 100vw; height: 100vh;">

        <div style="width: 100%; height: 100%; position: absolute; display: flex; align-items: center; justify-content: center; flex-direction: column;
                background: url('img/blueBackground.png'); background-size: cover; background-position: center center; background-repeat: no-repeat;">

            <div style="height:2rem; position: relative; color: #36ddff; font-size: 1.7rem;
                    display:flex; justify-content: center; font-weight: 700;">
                <div>
                    汇智AI账户自动构建中
                </div>
                <div style="position: relative;width: 2rem">
                    {{ titleValue }}
                </div>
            </div>

            <!-- 进度条  -->
            <div style="position: relative; width: 20rem; height: 12rem; border-radius: 1rem;
                        background: url('img/progressBarBackground.png'); margin-top: 5rem; margin-bottom: 5rem;
                    background-size: cover; background-position: center center; background-repeat: no-repeat;">
                <div style="width: 100%; height: 100%; position: relative; display: flex; flex-direction: column; align-items: center; justify-content: center;">

                    <div class="progress" role="progressbar" aria-label="Example with label" aria-valuenow="25"
                         aria-valuemin="0" aria-valuemax="100" style="width: 80%; height: 2rem">
                        <div class="progress-bar progress-bar-striped" :style="width">{{ width.width }}</div>
                    </div>
                    <div style="margin-top: 1.5rem; color: #36ddff">
                        {{ textValue }}
                    </div>

                </div>
            </div>

            <div style="height: 2rem">

            </div>
        </div>

        <!-- 弹窗1 -->
        <div class="myCanvas" style="position: absolute; width: 20rem; height: 11rem; z-index: 1;
                border-radius: 1rem; margin-top: 0" :style="moveModal">
            <div style="width: 100%; height: 100%; position: relative;  padding: 1rem 0;
                    display: flex; justify-content: flex-start; align-items: center; flex-direction: column;">

                <div class="" style="font-size: 17px; margin-top: 0.1rem; margin-left: 0; color: white">
                    请输入手机号作为您的登录名
                </div>
                <div class="" style="position:relative;">
                </div>
                <div class=" canvasBottom-main-telephone" style="margin: 1rem auto 0 auto; width: 80%">
                    <input class="form-control myLineMode" type="tel" enterkeyhint="next" name="mobile"
                           v-model="inputValue" placeholder="请输入您的手机号码"/>
                </div>

                <div class="" style="width: 80%; margin-top: 1rem;">
                    <button class="btn myLineMode myBottom" style="width: 100%" @click="pushData($event)">
                        <span style="color: white">确认</span>
                    </button>
                </div>

            </div>
        </div>

        <!-- 弹窗2 -->
        <div class="" style="background-color: #38486CFF;" :style="modalStyle">
            <div style="width: 100%; height: 100%; position: relative;  padding: 1rem 0;
                    display: flex; justify-content: flex-start; align-items: center; flex-direction: column;">

                <div class="" style="font-size: 17px; margin-top: 0.1rem; margin-left: 0; color: white">
                    请输入手机号作为您的登录名
                </div>
                <div class="" style="position:relative;">
                </div>
                <div class=" canvasBottom-main-telephone" style="margin: 1rem auto 0 auto; width: 80%">
                    <input class="form-control myLineMode" type="tel" enterkeyhint="next" name="mobile"
                           v-model="inputValue" placeholder="请输入您的手机号码"/>
                </div>

                <div class="" style="width: 80%; margin-top: 1rem;">
                    <button class="btn myLineMode myBottom" style="width: 100%" @click="pushData($event)">
                        <span style="color: white">确认</span>
                    </button>
                </div>

            </div>
        </div>

    </div>
</div>
<script>

    const {createApp, ref, onMounted, nextTick} = Vue;
    const UpIcon = {
        template: `
        `,
        setup() {
        }
    };

    const App = {
        //使用短横线命名
        components: {
            UpIcon,
        },
        setup() {
            /**
             * 电话填写相关组件
             */
            const inputValue = ref("");
            // 确认按钮
            const modalStyle = ref({
                display: 'none',
                position: 'absolute',
                left: '50%',
                top: '50%',
                // transform: 'scale(0.5)',
                transition: 'transform 0.5s',
                transform : 'translate(-50%, -50%) scale(0.5)',
                // transformOrigin: 'center center',
                "z-index": 3,
            })

            const pushData = async (event) => {
                // 获取按钮位置
                const btn = event.target;
                const {left, top, width, height} = btn.getBoundingClientRect();

                // 设置模态框的 transform-origin 属性为按钮的中心位置
                const btnCenterX = event.clientX || event.touches[0].clientX;
                const btnCenterY = event.clientY || event.touches[0].clientY;

                console.log("addr", btnCenterX, btnCenterY);

                modalStyle.value.transform = 'scale(0)';
                modalStyle.value.left = `${btnCenterX}px`;
                modalStyle.value.top = `${btnCenterY}px`;
                modalStyle.value.display = 'block';

                // 设置 transform-origin 为模态框的中心
                modalStyle.value.transformOrigin = 'center center';
                // 开始在点击位置显示并缩放模态框
                modalStyle.value.transform = 'translate(-50%, -50%) scale(0.3)';

                // 等待DOM更新完成
                await nextTick();

                // 上一帧渲染完成后新的一帧
                requestAnimationFrame(() => {
                    modalStyle.value.left = "50%";
                    modalStyle.value.top = "50%";
                    modalStyle.value.transform = 'translate(-50%, -50%) scale(1)';
                });


                // showText(100, "", );
                // console.log(inputValue.value);
                //
                // moveModal.value.transform = "translateY(0)";
                // moveTop.value.transform = "translateY(-3rem)";
                // moveModal.value.animation = "";
                // moveTop.value.animation = "";
                //
                // setTimeout(() => {
                //     moveModal.value.animation = "bounceIn 0.8s cubic-bezier(0.4, 0, 1, 1) reverse forwards";
                //     moveTop.value.animation = "bounceIn2 0.8s cubic-bezier(0.4, 0, 1, 1) reverse forwards"
                // }, 100);

            }


            const showModal = ref(false);

            // 样式部分
            const moveModal = ref({
                transform: " translateX(-100vw)",
            });

            const moveTop = ref({})

            const canvasBottomClose = () => {
                // offCanvas.hide();
                showModal.value = false;
            };

            const mySleep = async (ms = 1000) => {
                return new Promise(resolve => setTimeout(resolve, ms));
            };

            const showText = (value = 90, msg = "", time = 50) => {
                let ca = 0;
                const textTemp = textValue.value;
                const dataBreak = 2;
                const timeRun = setInterval(() => {
                    if (widthValue.value >= value) {
                        clearInterval(timeRun);
                    }
                    ca++;
                    if (ca === dataBreak) {
                        textValue.value = textTemp + "."
                    } else if (ca === dataBreak * 2) {
                        textValue.value = textTemp + ".."
                    } else if (ca === dataBreak * 3) {
                        textValue.value = textTemp + "..."
                        ca = 0;
                    }

                    width.value.width = widthValue.value + "%";
                    if (widthValue.value <= 100) {
                        widthValue.value++;
                    }

                }, time);
            }

            // 进度条相关组件
            const width = ref({
                width: 0 + "%",
            });

            let widthValue = ref(0);
            const textValue = ref("系统排队中");

            /**
             * 标题加点相关组件
             */
            const titleValue = ref("");

            const titleStart = () => {
                let ca = 0;
                const titleValueTemp = titleValue.value;

                const timeRun = setInterval(() => {
                    ca++;
                    const dataBreak = 2;
                    if (ca === dataBreak) {
                        titleValue.value = "."
                    } else if (ca === dataBreak * 2) {
                        titleValue.value = ".."
                    } else if (ca === dataBreak * 3) {
                        titleValue.value = "..."
                        ca = 0;
                    }
                }, 150);

            }


            // 进度条定时程序
            const goTo = async () => {


                // showModal.value = true;
                setTimeout(() => {
                    moveModal.value.animation = "bounceIn 0.8s cubic-bezier(0.4, 0, 1, 1) forwards";
                    moveTop.value.animation = "bounceIn2 0.8s cubic-bezier(0.4, 0, 1, 1) forwards";
                }, 100);

                showText(20, "", 100);
                await mySleep((20 + 2) * 100);

                const randomValue = Math.floor(Math.random() * 100);
                textValue.value = "前面还有" + randomValue + "位用户";
                const randomValue1 = Math.floor(Math.random() * 10 + 35);
                showText(randomValue1, "", 200);
                await mySleep((randomValue1 + 5 - 20) * 200);

                textValue.value = "AI模型创建中";
                const randomValue2 = Math.floor(Math.random() * 10 + 70);
                showText(randomValue2, "", 200);
                await mySleep((randomValue2 - randomValue1 + 5) * 100);

                textValue.value = "汇智AI账户生成中";
                // const randomValue3 =  Math.floor(Math.random() * 10 + 80);
                showText(90, "", 100);
                await mySleep((90 - randomValue2 + 12) * 100);

                textValue.value = "仅差最后一步";


            }

            onMounted(() => {
                // offCanvas = new bootstrap.Offcanvas("#canvasBottom");

                goTo();
                titleStart();
            })

            return {
                width, widthValue, canvasBottomClose,
                textValue, showModal, moveModal, moveTop,
                pushData, inputValue, titleValue, modalStyle,
            };
        }
    };

    createApp(App).mount('#app');
</script>
</body>
</html>
