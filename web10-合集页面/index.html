<!DOCTYPE html>
<html lang="">
<head>
    <meta charset="UTF-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Hello World</title>
    <script src="./js/react.development.js"></script>
    <script src="./js/react-dom.development.js"></script>
    <script src="./js/rc-select-esm.js"></script>
    <script src="./js/babel.min.js"></script>
    <script src="./js/tailwindcss.3.3.5.js"></script>
    <script src="./js/axios.min.js"></script>
</head>
<body>

<div id="root"></div>
<script type="module">
    import Select, { Option } from './js/rc-select-esm';
</script>
<script type="text/babel">
    const {createRoot} = ReactDOM;
    // 使用 React 和 ReactDOM
    const {useState, createContext, useContext, useEffect, useRef} = React;

    // 创建一个全局数组的 Context
    const GlobalArrayContext = createContext();

    // 创建一个全局数组的 Provider 组件
    function GlobalArrayProvider({children}) {
        const [globalArray, setGlobalArray] = useState([]);

        // 更新全局数组的函数
        function updateGlobalArray(newItem) {
            setGlobalArray([...newItem]);
        }

        return (
            <GlobalArrayContext.Provider value={{globalArray, updateGlobalArray}}>
                {children}
            </GlobalArrayContext.Provider>
        );
    }

    // 创建一个自定义钩子以在组件中使用全局数组
    function useGlobalArray() {
        const context = useContext(GlobalArrayContext);
        if (!context) {
            throw new Error('useGlobalArray must be used within a GlobalArrayProvider');
        }
        return context;
    }

    // 创建一个使用全局数组的组件
    function MyComponent1() {
        const {globalArray, updateGlobalArray} = useGlobalArray();

        useEffect(() => {
            // 模拟从外部添加数据到全局数组
            setTimeout(() => updateGlobalArray('New Item'), 2000);
            setTimeout(() => {
                updateGlobalArray(["1", "2", "3"]);
                console.log("globalArray", globalArray);
            }, 2500);
        }, []);

        return (
            <div>
                <h2>Global Array Items:</h2>
                <ul>
                    {globalArray.map((item, index) => <li key={index}>{item} 123123\n</li>)}
                </ul>
            </div>
        );
    }

    function MyComponent2() {
        const {globalArray, updateGlobalArray} = useGlobalArray();

        return (
            <div>
                <h2>Global Array Items:</h2>
                <ul>
                    {globalArray.map((item, index) => <li key={index}>{item}</li>)}
                </ul>
            </div>
        );
    }


    const imageUrls = [
        '../img/nature-1.jpg',
        '../img/nature-2.jpg',
        '../img/nature-3.jpg',
        '../img/nature-4.jpg',
        '../img/nature-1.jpg',
        '../img/nature-2.jpg',
        '../img/nature-3.jpg',
        '../img/nature-4.jpg',
        '../img/nature-1.jpg',
        '../img/nature-2.jpg',
        '../img/nature-3.jpg',
        '../img/nature-4.jpg',
    ];

    //搜索
    const Search = () => {
        return (
            <div className="relative">
                <label>
                    <input type="text" className="pl-10 pr-10 py-2 border rounded-lg w-full" placeholder="Search..."/>
                </label>
                <button type="submit" className="absolute inset-y-0 right-0 px-4 text-white bg-blue-500 rounded-r-lg">
                    <svg className="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
                         width="20" height="20">
                        <path
                            d="M966.4 924.8l-230.4-227.2c60.8-67.2 96-156.8 96-256 0-217.6-176-390.4-390.4-390.4-217.6 0-390.4 176-390.4 390.4 0 217.6 176 390.4 390.4 390.4 99.2 0 188.8-35.2 256-96l230.4 227.2c9.6 9.6 28.8 9.6 38.4 0C979.2 950.4 979.2 934.4 966.4 924.8zM102.4 441.6c0-185.6 150.4-339.2 339.2-339.2s339.2 150.4 339.2 339.2c0 89.6-35.2 172.8-92.8 233.6-3.2 0-3.2 3.2-6.4 3.2-3.2 3.2-3.2 3.2-3.2 6.4-60.8 57.6-144 92.8-233.6 92.8C256 780.8 102.4 627.2 102.4 441.6z"></path>
                    </svg>
                </button>
            </div>
        )
    }

    // 导航栏
    const Navbar = () => {
        return (
            <nav className="bg-gray-800 text-white p-4">
                <div className="container mx-auto flex justify-between items-center">
                    <div className="text-lg font-bold">
                        这里放logo
                    </div>
                    <Search/>
                </div>
            </nav>
        );
    };

    // 画册布局
    const ImageListComponent = ({images}) => {

        return (
            <div
                className="grid grid-cols-2 gap-2 sm:grid-cols-3 sm:gap-3 md:grid-cols-4 md:gap-4 lg:grid-cols-5 lg:gap-5 xl:grid-cols-6 xl:gap-6 2xl:grid-cols-7 2xl:gap-7">
                {images.map((imageUrl, index) => (
                    <div className="">
                        <div key={index} className="" style={{}}>
                            <img src={imageUrl} alt={`Image ${index}`} className="max-w-full h-auto"/>
                            <div>{index}</div>
                        </div>
                    </div>
                ))}
            </div>
        );
    };

    const MyComponent = () => {
        const [items, setItems] = useState([]);

        const addItem = newItem => {
            setItems([...items, newItem]);
        };

        return (
            <div>
                {items.map((item, index) => (
                    <div key={index}>{item}</div>
                ))}
                <button onClick={() => addItem('New Item')}>Add Item</button>
            </div>
        );
    };


    const MultiSelectDropdown = ({options}) => {
        const [searchTerm, setSearchTerm] = useState('');
        const [filteredOptions, setFilteredOptions] = useState([]);
        const [selectedOptions, setSelectedOptions] = useState([]);
        const [isDropdownOpen, setIsDropdownOpen] = useState(false);

        const dropdownRef = useRef(null);

        useEffect(() => {
            setFilteredOptions(options);
        }, [options]);

        useEffect(() => {
            const filtered = options.filter(option =>
                option.label.toLowerCase().includes(searchTerm.toLowerCase())
            );
            setFilteredOptions(filtered);
        }, [searchTerm, options]);

        useEffect(() => {
            const handleClickOutside = (event) => {
                if (dropdownRef.current && !dropdownRef.current.contains(event.target)) {
                    setIsDropdownOpen(false);
                    handleBlur();
                    setTimeout(() => {
                        handleBlur();
                    }, 100);
                }
            };
            document.addEventListener('mousedown', handleClickOutside);
            return () => document.removeEventListener('mousedown', handleClickOutside);
        }, [dropdownRef]);

        // useEffect(() => {
        //     const displayValue = selectedOptions.map(option =>
        //         options.find(opt => opt.value === option).label
        //     ).join(", ");
        //     setInputDisplay(displayValue);
        // }, [selectedOptions, options]);

        const handleSelect = (selectedOption) => {
            const newSelectedOptions = selectedOptions.includes(selectedOption)
                ? selectedOptions.filter(option => option !== selectedOption)
                : [...selectedOptions, selectedOption];
            setSelectedOptions(newSelectedOptions);
        };

        const [inputDisplay, setInputDisplay] = useState('');

        const handleBlur = () => {
            // 用户离开输入框时更新显示的内容
            // const displayValue = selectedOptions.map(option =>
            //     options.find(opt => opt.value === option).label
            // ).join(", ");
            // setInputDisplay(displayValue);
        };

        return (
            <div className="w-64 relative" ref={dropdownRef}>
                <input
                    type="text"
                    className="w-full px-3 py-2 border border-gray-300 rounded-md"
                    placeholder="Search..."
                    onChange={(e) => setSearchTerm(e.target.value)}
                    onFocus={() => setIsDropdownOpen(true)}
                    value={inputDisplay}
                    onBlur={handleBlur}
                />

                {isDropdownOpen && (
                    <div
                        className="absolute w-full mt-1 border border-gray-300 rounded-md bg-white shadow-lg overflow-y-auto max-h-40 z-10">
                        {filteredOptions.slice(0, 10).map(option => (
                            <div key={option.value}
                                 className="flex items-center p-2 border-b border-gray-300 last:border-b-0">
                                <input
                                    type="checkbox"
                                    checked={selectedOptions.includes(option.value)}
                                    onChange={() => handleSelect(option.value)}
                                    className="mr-2"
                                />
                                <label>{option.label}</label>
                            </div>
                        ))}
                    </div>
                )}
            </div>
        );
    };


    const options = [
        {value: 'option1', label: 'Option 1'},
        {value: 'option2', label: 'Option 2'},
        {value: 'option3', label: 'Option 3'}
        // ... 更多选项
    ];

    function MyApp() {
        return (
            <>
                <div style={{background: 'url("../img/nature-1.jpg")', height: '100vh', width: '100vw'}}>
                    <Navbar/>
                    <MultiSelectDropdown options={options}/>
                    <MyComponent/>
                    <GlobalArrayProvider>
                        <MyComponent1/>
                        <MyComponent2/>
                    </GlobalArrayProvider>
                    <div className="mt-5 container mx-auto grid grid-cols-12">
                        <div className="col-span-1 md:col-span-2"></div>
                        <div className="col-span-10 md:col-span-8">
                            <ImageListComponent images={imageUrls}/>
                        </div>
                    </div>
                </div>
            </>
        );
    }

    const container = document.getElementById('root');
    const root = createRoot(container);
    root.render(<MyApp/>);

</script>
</body>
</html>
